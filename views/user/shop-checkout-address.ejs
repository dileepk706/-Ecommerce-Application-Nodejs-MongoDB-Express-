<!DOCTYPE html>
<html lang="en">
<head>
     <!-- metas -->
     <meta charset="utf-8">
     <meta name="author" content="Chitrakoot Web" />
     <meta http-equiv="X-UA-Compatible" content="IE=edge" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
     <meta name="keywords" content="Multipurpose eCommerce Template + Admin" />
     <meta name="description" content="Smartshop - Multipurpose eCommerce Template + Admin" />
 
     <!-- title  -->
     <title>shopSmart</title>
 
     <!-- favicon -->
     <link rel="shortcut icon" href="/public/img/logos/favicon.png">
     <link rel="apple-touch-icon" href="/public/img/logos/apple-touch-icon-57x57.png">
     <link rel="apple-touch-icon" sizes="72x72" href="/public/img/logos/apple-touch-icon-72x72.png">
     <link rel="apple-touch-icon" sizes="114x114" href="/public/img/logos/apple-touch-icon-114x114.png">
 
     <!-- plugins -->
     <link rel="stylesheet" href="/public/css/plugins.css">
 
     <!-- theme core css -->
     <link href="/public/css/product_styles.css" rel="stylesheet">
</head>
<body>
    <%- include('include/_header')%>


    <section class="md">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="process-steps mb-1-9 mb-lg-6">
                        <a class="step active" href=" "><i class="ti-direction-alt"></i><h4 class="step-title">1. Address</h4></a>
                        <!-- <a class="step" href=""><i class="ti-truck"></i><h4 class="step-title">2. Shipping</h4></a> -->
                        <a class="step" href=" "><i class="ti-wallet"></i><h4 class="step-title">3. Payment</h4></a>
                        <a class="step" href=" "><i class="ti-check-box"></i><h4 class="step-title">4. Review</h4></a>
                    </div>
                </div>

                <!-- left pannel section -->
                <div style="width: 65%;" class="col-lg-9 col-12 pe-lg-2-3 mb-1-9 mb-lg-0">

                    <div class="common-block">

                        <div class="inner-title">
                            <h4 class="mb-0">Billing Address</h4>
                        </div>

                       
                                <div class="col-sm-6">

                                    <div class="form-group">

                                        <% address.forEach(addrss => { %>
                                            <div class="m-3">
                                                <label>
                                                  <input type="radio" id="shipping_adress" name="shippingAddress" value="<%= addrss.name %> (<%= addrss.phone %>)  <%= addrss.address%>, <%= addrss.city %>, <%= addrss.state %>, PIN:<%= addrss.pincode %> , land-mark:<%= addrss.landmark %> " checked> <%= addrss.name %> (<%= addrss.phone %>)  <%= addrss.address%>, <%= addrss.city %>, <%= addrss.state %>, PIN:<%= addrss.pincode %> , land-mark:<%= addrss.landmark %> 
                                                </label>
                                              </div>
                                            <% }) %>
                                          
                                    </div>
                                    <div class="buttons-set">
                                        <button type="button" class="butn-style2 wide" data-toggle="modal" data-target="#myModal">
                                            Add new Address
                                          </button>

                                        <a style="cursor: pointer;" onclick="address()"  class="butn-style2 wide">Continue <i class="fas fa-arrow-right ms-1"></i></a>
                                    </div>
                                </div> 
                                <!-- href="/checkout-payment" -->
                    </div>
                    

                </div>
                <!-- end left pannel section -->

                <!-- right pannel section -->
                <div style="width: 35%;" class="col-lg-3 col-12 side-bar">

                    <div class="widget">

                        <div class="widget-title">
                            <h5>Order Summary</h5>
                        </div>

                        <table class="table classic">
                            <tbody>
                                <% cartData.product.forEach(prdct => { %>

                                    <tr>
                                        <th><%= prdct.item.name %>:</th>
                                        <td class="text-gray-dark">â‚¹ <%= prdct.sub_total %> </td>
                                    </tr>

                                    <% }) %>
                                
                                <tr>
                                    <th>Shipping:</th>
                                    <td class="text-gray-dark">Free</td>
                                </tr>
                                <tr>
                                    <th>Estimated tax:</th>
                                    <td class="text-gray-dark">$0.00</td>
                                </tr>
                                <tr>
                                    <th>Total:</th>
                                    <td class="text-lg text-gray-dark">$<%= cartData.total_amount %></td>
                                </tr>
                            </tbody>
                        </table>

                    </div>

                    <!-- <div class="widget">

                        <div class="widget-title">
                            <h5>Popular Products</h5>
                        </div>

                        <div class="d-flex mb-4">
                            <div class="flex-shrink-0">
                                <img src="img/products/thumbs/thumb-06.jpg" alt="...">
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <a href="#" class="mb-1 font-weight-600 text-extra-dark-gray">Men's Football Boots</a>
                                <span class="d-block">$15.00</span>
                            </div>
                        </div>

                        <div class="d-flex mb-4">
                            <div class="flex-shrink-0">
                                <img src="img/products/thumbs/thumb-01.jpg" alt="...">
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <a href="#" class="mb-1 font-weight-600 text-extra-dark-gray">Leather Motorcycle Gloves</a>
                                <span class="d-block">$12.10</span>
                            </div>
                        </div>

                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <img src="img/products/thumbs/thumb-02.jpg" alt="...">
                            </div>
                            <div class="flex-grow-1 ms-3">
                                <a href="#" class="mb-1 font-weight-600 text-extra-dark-gray"> Sun Protection Cap </a>
                                <span class="d-block">$10.20</span>
                            </div>
                        </div>

                    </div> -->

                </div>
                <!-- end right pannel section -->
            </div>
        </div>
    </section>



    
  <!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">



            <form action="/add_address" method="post">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" class="form-control" name="name" placeholder="Your company name here" required>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>10-digit mobile number</label>
                                <input type="number" class="form-control" name="phone" placeholder="Your address here" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>address</label>
                                <input type="text" class="form-control" name="address" placeholder="Your address here" required>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group"> 
                                <label>pincode</label>
                                <input type="text" class="form-control" name="pincode" placeholder="Your city name here" required>
                            </div>
                        </div>
                       
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>City</label>
                                <input type="text" class="form-control" name="city" placeholder="Your city name here" required>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label>State</label>
                                <input type="text" class="form-control" name="state" placeholder="Your state name here" required>
                            </div>
                        </div>
                    </div>
                   
                    <!-- inform the rquest coming from chekout page -->
                      <input type="text"  name="checkout" value="true"  hidden>
                          
                    <!-- <div class="inner-title mt-1-9">
                        <h4 class="mb-0">Shipping Address</h4>
                        </div> -->
                    <!-- 
                        <div class="row">
                            <div class="col-sm-12 mb-2">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="" id="same-contact">
                                    <label class="form-check-label" for="same-contact">Same as contact address</label>
                                </div>
                            </div>
                        </div> -->
                        <button type="submit" class="btn btn-primary">Submit</button>
                </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      
    </div>
  </div>
</div>
</div>
    
    <script>
        function address(){
         const addrs = document.querySelectorAll('input[name="shippingAddress"]');
         let selectedAddress = '';
         for (let i = 0; i < addrs.length; i++) {
           if (addrs[i].checked) {
             selectedAddress = addrs[i].value;
             break;
           }
         }
         fetch(`http://localhost:3000/checkout-address-save?address=${selectedAddress}`, {
           method: 'GET',
         })
         .then(responce=>responce.json()).then(data=>{
         //   alert(data.message);  
           window.location.href = '/checkout-payment';
         }).catch(err=>{
           alert('Error'+err);
         })                       
         console.log(selectedAddress);
     }

     </script>
     <!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
crossorigin="anonymous"></script>

<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
crossorigin="anonymous"></script>
    
</body>
</html>